---
title: "Participants"
output:
  md_document:
    variant: markdown_github
  html_document:
    df_print: paged
    toc: true
    toc_depth: 4
    toc_float: true
bibliography: "references.bib"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = TRUE,
  warning = TRUE, 
  cache.extra = knitr::rand_seed,
  out.width = "80%",
  results = "asis",
  dpi = 300,
  dev.args = list(png = list(type = "cairo"))
)

options(
  knitr.kable.NA = '-',
  knitr.duplicate.label = "allow",
  ggplot2.discrete.fill = c("#1A85FF", "#ff2976", "#FFC20A"),
  ggplot2.discrete.colour = c("#1A85FF", "#ff2976", "#FFC20A"),
  ggplot2.continuous.fill = scale_fill_gradient2(
    low = "#04bf78", mid = "white", high = "#FFC20A", 
    na.value = "white", limits = c(-0.4, 0.4)
  ),
  ggplot2.continuous.colour = scale_fill_gradient2(
    low = "#04bf78", mid = "white", high = "#FFC20A", 
    na.value = "white", limits = c(-0.4, 0.4)
  )
)
```

```{r prepare}
# import data
tar_load_globals()
tar_load(participants)
tar_load(responses)

theme_set(theme_custom())
```


```{r participants_coded}
participants_coded <- participants %>% 
  mutate(valid_participant = ifelse(valid_participant, "Valid", "Not valid"))
```

We collected data from `r format(as_date(min(participants$date)), "%B %dth %Y")` to `r format(as_date(max(participants$date)), "%B %dth %Y")`. We tested `r length(unique(participants$participant))` participants. `r length(unique(participants$participant[participants$group=="ENG-SPA"]))` were English natives tested in Spanish, `r length(unique(participants$participant[participants$group=="ENG-CAT"]))` were English natives tested in Catalan, and `r length(unique(participants$participant[participants$group=="SPA-CAT"]))` were Spanish natives tested in Catalan. `r sum(!participants$valid_participant)` failed to meet all the inclusion criteria and were excluded from further analyses. The final sample comprised data from `r sum(!participants$valid_participant)` participants, `r sum(participants$valid_participant[participants$group=="ENG-SPA"])` in the ENG-SPA group, `r sum(participants$valid_participant[participants$group=="ENG-CAT"])` in the ENG-CAT group, and `r sum(participants$valid_participant[participants$group=="SPA-CAT"])` in the SPA-CAT group.

Participants were included if^[We originally planned to exclude participants that reported any visual impairment that glasses would not correct. This item was phrased as Do you have normal or corrected-to-normal VISION? (Yes/No) in English, and as ¿Tienes problemas de VISIÓN que unas gafas o lentes de contacto NO corrijan? (Sí/No). Surprisingly, the proportion of Spanish participants that reported visual impairment was implausibly large (n = 6, 18.18%). This is possibly due to some participants using glasses daily and not having read the item until the end, where it is indicated that the use of glasses is considered as normal vision]:

* Aged 18 to 25 years
* Did not report being fluent in Catalan, Spanish, or Italian
* Provided at least 80% of the presented trials
* Did not report motor, auditory or visual (other than wearing glasses) problems

Trials were considered valid if:

* Participant did not leave a blank response
* Participant took longer than 10 seconds to respond

# Summary

```{r participants_summary, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

participants_coded %>% 
  count(group, valid_participant) %>% 
  mutate(valid_participant = factor(valid_participant)) %>% 
  ggplot(aes(group, n, fill = valid_participant, order = n)) +
  geom_col() +
  labs(x = "Group", y = "# participants", fill = "Valid?") +
  theme(
    legend.title = element_blank(),
    legend.position = "top",
    axis.title.x = element_blank(),
    panel.grid.major.y = element_line(linetype = "dotted", colour = "grey")
  )

```

# Valid trials

```{r participants_stimuli, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

participants_coded %>% 
  filter(valid_participant=="Valid") %>% 
  select(participant, group, n, n_valid) %>%
  mutate(valid_prop = n_valid/n) %>% 
  ggplot(aes(valid_prop, fill = group, colour = group)) +
  facet_wrap(~group, ncol = 1) +
  geom_histogram() +
  geom_rug() +
  labs(x = "Valid trials (%)", y = "N participants", fill = "Group", colour = "Group") +
  scale_x_continuous(limits = c(0, 1), labels = percent) +
  theme(
    legend.title = element_blank(),
    legend.position = "none",
    axis.title.x = element_blank(),
    panel.grid.major.y = element_line(linetype = "dotted", colour = "grey")
  )
```

# Demographic information

```{r participants_demo, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
participants_valid <- filter(participants_coded, valid_participant=="Valid")

p_sex <- participants_valid %>% 
  left_join(count(participants_valid, group, name = "n_total")) %>% 
  mutate(group = paste0(group,  "\n(N = ", n_total, ")")) %>% 
  ggplot(aes(group, fill = sex)) +
  geom_bar(position = position_fill()) +
  labs(x = "Group", y = "# participants", fill = "Sex") +
  scale_y_continuous(labels = percent) +
  theme(
    legend.position = "top",
    axis.title.x = element_blank()
  )

p_age <- participants_valid %>% 
  left_join(count(participants_valid, group, name = "n_total")) %>% 
  mutate(group = paste0(group,  " (N = ", n_total, ")")) %>% 
  ggplot(aes(as.factor(age), fill = group, colour = group)) +
  facet_wrap(~group, ncol = 1) +
  geom_bar() +
  labs(x = "Age (years)", y = "% participants", fill = "Group", colour = "Group") +
  theme(
    legend.position = "none"
  )


(p_sex + p_age) &
  plot_layout() &
  plot_annotation(tag_levels = "A") &
  theme(
    legend.title = element_blank(),
    panel.grid.major.y = element_line(linetype = "dotted", colour = "grey")
  )

```



# Second language

```{r participants_l2, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

participants_valid %>% 
  count(group, l2) %>% 
  mutate(
    l2 = case_when(
      l2=="Alemã\u0081n" ~ "German",
      l2=="Francã\u2030s" ~ "French",
      l2=="Cuã\u0081l" ~ "Missing",
      TRUE ~ l2
    ),
  ) %>% 
  left_join(count(participants_valid, group, name = "n_total")) %>% 
  mutate(group = paste0(group,  "\n(N = ", n_total, ")")) %>% 
  ggplot(aes(group, n, fill = l2)) +
  facet_wrap(~group, ncol = 1, scales = "free_y") +
  geom_col(position = position_fill()) +
  labs(x = "L2", y = "# participants", fill = "L2") +
  scale_y_continuous(labels = percent) +
  coord_flip() +
  theme(
    legend.position = "top",
    legend.title = element_blank(),
    strip.text = element_blank(),
    panel.grid = element_blank(),
    axis.text.x = element_text(angle = 90),
    axis.title.y = element_blank()
  )

```


# Language profile proficiency

```{r participants_proficiency, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

participants_valid %>% 
  select(participant, group, catalan_oral, spanish_oral, catalan_written, spanish_written) %>% 
  mutate_at(vars(catalan_oral, spanish_oral, catalan_written, spanish_written), replace_na, 0) %>% 
  pivot_longer(c(catalan_oral, spanish_oral, catalan_written, spanish_written),
               names_to = "type", values_to = "score") %>% 
  separate(type, c("language", "modality"), sep = "_") %>% 
  mutate_at(vars(language, modality), str_to_sentence) %>%
  left_join(count(participants_valid, group, name = "n_total")) %>% 
  mutate(group = paste0(group,  " (N = ", n_total, ")")) %>% 
  ggplot(aes(as.integer(score), fill = language)) +
  facet_grid(modality~group) +
  geom_bar(position = position_dodge()) +
  labs(y = "# participants", x = "Self-reported proficiency (0-5)", fill = "Language") +
  theme(
    legend.position = "top",
    panel.grid.major.y = element_line(colour = "grey", linetype = "dotted")
  )

```


