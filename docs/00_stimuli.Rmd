---
title: "Stimuli"
output:
  md_document:
    variant: markdown_github
  html_document:
    df_print: paged
    toc: true
    toc_depth: 4
    toc_float: true
bibliography: "references.bib"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = TRUE,
  warning = TRUE, 
  cache.extra = knitr::rand_seed,
  out.width = "80%",
  results = "asis",
  dpi = 300,
  dev.args = list(png = list(type = "cairo"))
)

options(
  knitr.kable.NA = '-',
  knitr.duplicate.label = "allow",
  ggplot2.discrete.fill = c("#1A85FF", "#ff2976", "#FFC20A"),
  ggplot2.discrete.colour = c("#1A85FF", "#ff2976", "#FFC20A"),
  ggplot2.continuous.fill = scale_fill_gradient2(
    low = "#04bf78", mid = "white", high = "#FFC20A", 
    na.value = "white", limits = c(-0.4, 0.4)
  ),
  ggplot2.continuous.colour = scale_fill_gradient2(
    low = "#04bf78", mid = "white", high = "#FFC20A", 
    na.value = "white", limits = c(-0.4, 0.4)
  )
)
```

```{r prepare}
# import data
tar_load_globals()
tar_load(stimuli)

theme_set(theme_custom())
```

# Overview

Participants in the ENG-SPA listened to `r nrow(stimuli[stimuli$group=="ENG-SPA",])` Spanish words, and participants in the ENG-CAT and the SPA-CAT groups listened to `r nrow(stimuli[stimuli$group=="ENG-CAT",])` trials. Five trials in each condition were practice trials and were excluded from analyses.

```{r stimuli_coded, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE,  include=FALSE}
stimuli_coded <- mutate(stimuli, test_language = ifelse(group=="ENG-SPA", "Spanish", "Catalan"))
```

```{r stimulitable, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
tb_stimuli <- stimuli %>% 
  select(group, word1, frequency, frequency_zipf, pthn, lv) %>% 
  group_by(group) %>% 
  summarise_at(
    vars(frequency:lv), 
    list(
      mean = ~mean(., na.rm = TRUE),  
      sd = ~sd(., na.rm = TRUE)
    )
  ) %>%
  gt(rowname_col = "group") %>% 
  tab_header(
    title = md("Table 1"),
    subtitle = md("Lexical frequency, phonological neigbourhood size, and levenshtein distance of the stimuli words.")
  ) %>% 
  tab_source_note(
    md("*Note*. Mean and standard deviation (*SD*) of lexical frequencies of target words (expressed in counts per million and as Zipf scores), density of higher-frequency phonological neighbourhoods of target words, and normalised Levenshtein phonological similarity between the presented and the target words.")
  ) %>% 
  fmt_number(frequency_mean:pthn_sd) %>%
  fmt_percent(matches("lv")) %>% 
  tab_spanner(md("**Freq. (million)**"), c("frequency_mean", "frequency_sd")) %>% 
  tab_spanner(md("**Freq. (Zipf)**"), matches("frequency_zipf")) %>% 
  tab_spanner(md("***PTHN***"), matches("pthn")) %>% 
  tab_spanner(md("**Levenshtein**"), matches("lv")) %>% 
  cols_label(
    frequency_mean = md("Mean"),
    frequency_sd = md("*SD*"),
    frequency_zipf_mean = md("Mean"),
    frequency_zipf_sd = md("*SD*"),
    pthn_mean = md("Mean"),
    pthn_sd = md("*SD*"),
    lv_mean = md("Mean"),
    lv_sd = md("*SD*")
  ) %>% 
  summary_rows(
    columns = c(matches("mean"), -matches("lv")),
    fns = list(
      Mean = "mean",
      SD = "sd"
    )
  ) %>% 
  summary_rows(
    columns = matches("lv"),
    fns = list(
      Mean = "mean",
      SD = "sd"
    ), formatter = fmt_percent
  ) %>% 
  tab_style(
    style = cell_text(align = "left", weight = "bold", size = "medium"),
    locations = cells_title(groups = "title")
  ) %>% 
  tab_style(
    style = cell_text(align = "left", size = "medium", style = "italic"),
    locations = cells_title(groups = "subtitle")
  ) %>% 
  tab_style(
    style = cell_text(align = "left", size = "medium"),
    locations = cells_source_notes()
  ) %>% 
  tab_style(
    style = cell_text(align = "left", size = "medium"),
    locations = cells_stub_grand_summary()
  ) %>% 
  tab_style(
    style = cell_borders(sides = c("left", "right"), color = "white"),
    locations = list(
      cells_body(), cells_row_groups(), cells_column_spanners(), 
      cells_stub(), cells_stub_grand_summary(), cells_source_notes(),
      cells_column_labels(), cells_stubhead()
    )
  ) %>% 
  tab_style(
    style = list(cell_text(align = "left", size = "medium"), cell_borders(sides = "all", color = "white")),
    locations = cells_stub()
  ) %>% 
  tab_style(
    style = cell_text(align = "center", size = "medium", weight = "normal", style = "normal"),
    locations = list(cells_column_spanners(), cells_column_labels())
  ) %>% 
  tab_style(
    style = cell_borders(sides = "all", color = "white"),
    locations = cells_body(columns = 1:9)
  ) %>% 
  tab_style(
    style = cell_borders(sides = "top", color = "white"),
    locations = cells_body(columns = 1:9)
  ) %>% 
  gtsave(here("img", "stimuli.png"))

include_graphics(here("img", "stimuli.png"), auto_pdf = FALSE)

```

# Lexical frequency

```{r stimuli_frequency, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
stimuli_coded %>% 
  distinct(test_language, word1, .keep_all = TRUE) %>% 
  left_join(count(., test_language, name = "n_total")) %>% 
  mutate(test_language = paste0(test_language,  " (N = ", n_total, ")")) %>% 
  ggplot(aes(frequency_zipf, fill = test_language)) +
  facet_wrap(~test_language, ncol = 1) +
  geom_histogram(bins = 25, colour = "white") +
  labs(x = "Lexical frequency (Zipf score)\nExtracted from CLEARPOND database", y = "# trials", fill = "Test language")  +
  scale_y_continuous(breaks = seq(0, 12, 2)) +
  theme(
    legend.position = "none",
    panel.grid.major.y = element_line(colour = "grey", linetype = "dotted")
  )

```

# PTHN

```{r stimuli_pthn, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
stimuli_coded %>% 
  left_join(count(., test_language, name = "n_total")) %>% 
  mutate(test_language = paste0(test_language,  " (N = ", n_total, ")")) %>% 
  count(test_language, pthn) %>% 
  ggplot(aes(reorder(as.factor(pthn), -n), n, fill = test_language)) +
  facet_wrap(~test_language, ncol = 1) +
  geom_col(position = position_dodge()) +
  labs(x = "# Phonological neighbours with higher lexical frequency\nExtracted from CLEARPOND database", y = "# trials", fill = "Test language") +
  theme(
    legend.position = "none",
    panel.grid.major.y = element_line(colour = "grey", linetype = "dotted")
  )

```

# Phonological similarity

```{r stimuli_similarity, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}
stimuli_coded %>% 
  left_join(count(., group, name = "n_total")) %>% 
  mutate(group = paste0(group,  " (N = ", n_total, ")")) %>% 
  ggplot(aes(group, lv, fill = group, colour = group)) +
  geom_violin() +
  geom_point(shape = 1, stroke = 1, position = position_jitter(width = 0.1), colour = "black", alpha = 0.25) +
  geom_boxplot(colour = "black", fill = "white", width = 0.1, size = 0.75) +
  labs(x = "Group", y = "Phonological Leveshtein distance\n(corrected for string length)", fill = "Test language") +
  scale_y_continuous(limits = c(0, 1), labels = scales::percent) +
  theme(
    legend.position = "none",
    axis.title.x = element_blank(),
    panel.grid.major.y = element_line(colour = "grey", linetype = "dotted")
  ) 

```


# Correlations

```{r stimuliplot, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, out.width="100%", fig.width=7, fig.height=5.5, fig.cap="Distribution and summary statistics of stimuli translations, plotted in different panels for English translations of Catalan stimuli (cat-ENG), English translations of Spanish stimuli (spa-ENG), and Spanish translation of Catalan stimuli (cat-SPA). A\\) Lexical frequency of stimuli translations, expressed in counts per million and as Zipf scores. B\\) Number of higher-frequency phonological neighbourhoods (PTHN) of stimuli translations. C\\) Normalised Levenshtein phonological similarity between the presented stimuli and their translations, expressed in percentages. Lexical frequencies and PTHN scores of the stimuli (presented auditorily in Catalan or Spanish) are not described, as participants lack any lexical representation of such words."}

medians <- stimuli %>% 
  group_by(group) %>% 
  summarise(
    pthn_median = median(pthn),
    pthn_sd = sd(pthn),
    frequency_zipf_median = median(frequency_zipf),
    frequency_zipf_sd = sd(frequency_zipf),
    lv_median = median(lv),
    lv_sd = sd(lv)
  ) %>% 
  mutate(group = case_when(
    group=="ENG-CAT" ~ "cat-ENG",
    group=="ENG-SPA" ~ "spa-ENG",
    group=="SPA-CAT" ~ "cat-SPA",
  ))

# frequency
stimuli %>% 
  mutate(group = case_when(
    group=="ENG-CAT" ~ "cat-ENG",
    group=="ENG-SPA" ~ "spa-ENG",
    group=="SPA-CAT" ~ "cat-SPA",
  )) %>% 
  ggplot(aes(frequency_zipf, fill = group)) + 
  facet_wrap(~group, ncol = 1) + 
  geom_rect(
    data = medians, 
    aes(
      xmin = frequency_zipf_median-frequency_zipf_sd, xmax = frequency_zipf_median+frequency_zipf_sd, 
      ymin = -Inf, ymax = Inf, fill = group
    ), inherit.aes = FALSE, alpha = 0.15
  ) +   
  geom_histogram(bins = 20, colour = "white") +
  geom_vline(
    data = medians, 
    aes(xintercept = frequency_zipf_median, group = group), 
    colour = "black",
    size = 0.5,
    linetype = "dashed"
  ) + 
  geom_text(
    data = medians, 
    aes(
      label = "Median Â± SD", 
      x = frequency_zipf_median+1.25,
      y = 13
    ), 
    size = 3
  ) +
  geom_curve(
    data = medians, 
    aes(
      x = frequency_zipf_median+0.85, 
      xend = frequency_zipf_median+0.1,
      y = 12, 
      yend = 11
    ),
    arrow = arrow(length = unit(0.2, "cm")),
    curvature = -0.25,
    colour = "grey30"
  ) +
  labs(
    x = "Lexical frequency (Zipf)", 
    y = "Number of trials", 
    title = "Frequency\n(stimuli translations)\n"
  ) +
  
  # PTHN
  stimuli %>% 
  count(group, pthn) %>% 
  mutate(group = case_when(
    group=="ENG-CAT" ~ "cat-ENG",
    group=="ENG-SPA" ~ "spa-ENG",
    group=="SPA-CAT" ~ "cat-SPA",
  )) %>% 
  ggplot(aes(pthn, n, fill = group)) + 
  facet_wrap(~group, ncol = 1) + 
  geom_rect(
    data = medians, 
    aes(
      xmin = 0, 
      xmax = pthn_median+pthn_sd, 
      ymin = -Inf, 
      ymax = Inf,
      fill = group
    ), inherit.aes = FALSE, 
    alpha = 0.15
  ) +   
  geom_col(colour = "white") + 
  geom_vline(
    data = medians, aes(xintercept = pthn_median, group = group), 
    colour = "black", size = 0.5, linetype = "dashed"
  ) + 
  labs(
    x = "PTHN", 
    y = "Number of trials", 
    title = "Higher-frequency neighbours\n(stimuli translations)\n"
  ) +
  
  
  # Levenshtein
  stimuli %>% 
  mutate(group = case_when(
    group=="ENG-CAT" ~ "cat-ENG",
    group=="ENG-SPA" ~ "spa-ENG",
    group=="SPA-CAT" ~ "cat-SPA",
  )) %>% 
  ggplot(aes(lv, fill = group)) +
  facet_wrap(~group, ncol = 1) + 
  geom_rect(
    data = medians, 
    aes(
      xmin = 0, xmax = lv_median+lv_sd, 
      ymin = -Inf, ymax = Inf, fill = group
    ), inherit.aes = FALSE, alpha = 0.15
  ) +   
  geom_histogram(bins = 20, colour = "white") +
  geom_vline(
    data = medians, aes(xintercept = lv_median, group = group), 
    colour = "black", size = 0.5, linetype = "dashed"
  ) + 
  scale_x_continuous(labels = percent) +
  labs(x = "Levenshtein", y = "Number of trials", title = "Phonological similarity\n(stimuli and stimuli translations)\n") +
  
  plot_layout(guides = "collect") &
  plot_annotation(tag_levels = "A") &
  scale_fill_manual(values = c("#1A85FF", "#ff2976", "#FFC20A"), na.translate = FALSE) &
  theme(legend.position = "none")

```
